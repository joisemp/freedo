{% extends "base.html" %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'dashboard/style.css' %}">
{% endblock style %}

{% block navbar %}
{% include "navbar.html" %}
{% endblock navbar %}

{% block content %}

<section id="banner">
  <div class="container py-4">
    <div class="row">
      <div class="col">
        <h2 class="heading">Hello, {{ user.first_name }} {{ user.last_name }}</h2>
        <p class="sub-head">Letâ€™s take a quick look at your schedule, tasks, and progress for today</p>
      </div>
      <div class="col d-flex align-items-center justify-content-end">
        <p class="d-flex align-items-center mb-0 me-2 date">{{ today }}
        <div class="stat-icon">ğŸ“†</div>
        </p>
      </div>
    </div>
  </div>
</section>

<section id="stats">
  <div class="container py-4">
    <div class="d-flex flex-wrap border rounded p-3 text-center">

      <!-- Efficiency -->
      <div class="d-flex flex-row align-items-center justify-content-center flex-fill p-3 stat-block">
        <div class="stat-icon mb-2 me-2">ğŸ’°</div>
        <div>
          <h4 class="fw-semibold">â‚¹ {{ total_earnings }}</h4>
          <div class="d-flex align-items-center">
            <div class="fs-5">
              <a class="stat-link" href="#">Total Earnings</a>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex flex-row align-items-center justify-content-center flex-fill p-3 stat-block">
        <div class="stat-icon mb-2 me-2">ğŸ“‚</div>
        <div>
          <h4 class="fw-semibold">{{project_count}}</h4>
          <div class="d-flex align-items-center">
            <div class="fs-5">
              <a class="stat-link" href="#">Total Projects</a>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex flex-row align-items-center justify-content-center flex-fill p-3 last-block">
        <div class="stat-icon mb-2 me-2">ğŸ¢</div>
        <div>
          <h4 class="fw-semibold">{{client_count}}</h4>
          <div class="d-flex align-items-center">
            <div class="fs-5">
              <a class="stat-link" href="#">Total Clients</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<section id="chart-section">
  <div class="container py-4">
    <div>
      <h5 class="chart-title">Monthly Earnings</h5>
      <canvas id="earningsChart"></canvas>
    </div>
  </div>
</section>

<section id="tasks-section">
  <div class="container py-4">
    <h5 class="mb-4 tasks-title">Current Tasks</h5>
    {% if upcoming_tasks %}
    <ul class="list-group">
      {% for task in upcoming_tasks %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ task.title }}</strong>
          <small class="text-muted">({{ task.project.title }})</small>
        </div>
        <span class="badge bg-danger">Due: {{ task.due_date }}</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">No upcoming tasks found.</p>
    {% endif %}
  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('earningsChart').getContext('2d');
  const chartLabels = {{ chart_labels| safe }};
  const chartData = {{ chart_data| safe }};

  const earningsChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'Earnings â‚¹',
        data: chartData,
        backgroundColor: 'rgba(0, 123, 255, 0.6)',
        borderColor: '#007bff',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>
{% endblock content %}

